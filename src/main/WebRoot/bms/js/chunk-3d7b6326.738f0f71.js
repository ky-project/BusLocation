(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d7b6326"],{"0e08":function(t,e,n){"use strict";var i=n("c9d6"),a=n.n(i);a.a},"1f98":function(t,e,n){"use strict";var i=n("f425"),a=RegExp.prototype.exec,s=String.prototype.replace,r=a,o="lastIndex",c=function(){var t=/a/,e=/b*/g;return a.call(t,"a"),a.call(e,"a"),0!==t[o]||0!==e[o]}(),l=void 0!==/()??/.exec("")[1],d=c||l;d&&(r=function(t){var e,n,r,d,u=this;return l&&(n=new RegExp("^"+u.source+"$(?!\\s)",i.call(u))),c&&(e=u[o]),r=a.call(u,t),c&&r&&(u[o]=u.global?r.index+r[0].length:e),l&&r&&r.length>1&&s.call(r[0],n,(function(){for(d=1;d<arguments.length-2;d++)void 0===arguments[d]&&(r[d]=void 0)})),r}),t.exports=r},"22e9":function(t,e,n){var i=n("88dd"),a=n("94ac"),s=n("8b37")("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[s])?!!e:"RegExp"==a(t))}},"2f03":function(t,e,n){var i=n("c481"),a=n("f01a");t.exports=function(t){return function(e,n){var s,r,o=String(a(e)),c=i(n),l=o.length;return c<0||c>=l?t?"":void 0:(s=o.charCodeAt(c),s<55296||s>56319||c+1===l||(r=o.charCodeAt(c+1))<56320||r>57343?t?o.charAt(c):s:t?o.slice(c,c+2):r-56320+(s-55296<<10)+65536)}}},"2ffd":function(t,e,n){},"34a3":function(t,e,n){"use strict";var i=n("a013"),a=n("db4b"),s=n("b146"),r=n("c481"),o=n("b0f4"),c=n("35dd"),l=Math.max,d=Math.min,u=Math.floor,f=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g,h=function(t){return void 0===t?t:String(t)};n("629c")("replace",2,(function(t,e,n,v){return[function(i,a){var s=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,s,a):n.call(String(s),i,a)},function(t,e){var a=v(n,t,this,e);if(a.done)return a.value;var u=i(t),f=String(this),p="function"===typeof e;p||(e=String(e));var m=u.global;if(m){var b=u.unicode;u.lastIndex=0}var k=[];while(1){var y=c(u,f);if(null===y)break;if(k.push(y),!m)break;var S=String(y[0]);""===S&&(u.lastIndex=o(f,s(u.lastIndex),b))}for(var M="",x=0,C=0;C<k.length;C++){y=k[C];for(var L=String(y[0]),w=l(d(r(y.index),f.length),0),$=[],B=1;B<y.length;B++)$.push(h(y[B]));var D=y.groups;if(p){var I=[L].concat($,w,f);void 0!==D&&I.push(D);var E=String(e.apply(void 0,I))}else E=g(L,f,w,$,D,e);w>=x&&(M+=f.slice(x,w)+E,x=w+L.length)}return M+f.slice(x)}];function g(t,e,i,s,r,o){var c=i+t.length,l=s.length,d=p;return void 0!==r&&(r=a(r),d=f),n.call(o,d,(function(n,a){var o;switch(a.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,i);case"'":return e.slice(c);case"<":o=r[a.slice(1,-1)];break;default:var d=+a;if(0===d)return n;if(d>l){var f=u(d/10);return 0===f?n:f<=l?void 0===s[f-1]?a.charAt(1):s[f-1]+a.charAt(1):n}o=s[d-1]}return void 0===o?"":o}))}}))},"35dd":function(t,e,n){"use strict";var i=n("4819"),a=RegExp.prototype.exec;t.exports=function(t,e){var n=t.exec;if("function"===typeof n){var s=n.call(t,e);if("object"!==typeof s)throw new TypeError("RegExp exec method returned something other than an Object or null");return s}if("RegExp"!==i(t))throw new TypeError("RegExp#exec called on incompatible receiver");return a.call(t,e)}},"3a59":function(t,e,n){"use strict";var i=n("1f98");n("b2f5")({target:"RegExp",proto:!0,forced:i!==/./.exec},{exec:i})},"438a":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"station"}},[n("div",{staticClass:"left"},[n("baidu-map",{staticClass:"bm-view",attrs:{ak:"Hn8yCUyLlsPxzhCIdG8wETGiGtViLCHI",center:t.center,zoom:t.zoom},on:{ready:t.initMap}})],1),n("div",{staticClass:"right"},[n("transition",{attrs:{name:"slide"}},[n(t.curComponent,{ref:"childList",tag:"component",attrs:{stations:t.stations,stationForm:t.stationData,type:t.type},on:{delMarker:t.delLandMarker,addData:t.addData,editData:t.editData,editHandler:t.editHandler,lngChange:t.lngChange,latChange:t.latChange,cancelEdit:t.cacelEdit}})],1)],1)])},a=[],s=(n("fb37"),n("608b"),n("5bf7")),r=(n("f763"),n("ad5d")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"station_list"}},[n("div",{staticClass:"search"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.stationName,expression:"stationName"}],attrs:{type:"text",placeholder:"请输入站点名"},domProps:{value:t.stationName},on:{input:function(e){e.target.composing||(t.stationName=e.target.value)}}}),n("button",{on:{click:t.searchStation}},[n("i",{staticClass:"el-icon-search"})])]),n("div",{staticClass:"msg"},[n("span",[t._v("共"+t._s(t.stations.length)+"个站点")])]),n("happy-scroll",{staticClass:"stations",attrs:{resize:""}},[n("ul",{ref:"stationList",staticClass:"station-list"},t._l(t.stations,(function(e){return n("li",{key:e.id,staticClass:"item",attrs:{stationId:e.id},on:{click:function(n){return t.selectStation(n,e)}}},[n("div",{staticClass:"title"},[n("span",[t._v(t._s(e.sbsStation))]),n("b",{staticClass:"el-icon-delete",on:{click:function(n){return t.delStation(n,e)}}}),n("i",{staticClass:"el-icon-edit",on:{click:function(n){return t.$emit("editHandler",e)}}})]),n("p",{staticClass:"address"},[t._v(t._s(e.sbsDesc?e.sbsDesc:"暂无详细地址信息"))])])})),0)])],1)},c=[],l=(n("f301"),n("df99"),n("34a3"),{props:{stations:Array},data:function(){return{activeStation:null,stationName:""}},methods:{selectStation:function(t,e){var n=this;t.path.find((function(t){"item"===t.className&&n.addActiveStyle(t)}));var i=this.$parent.getMarkerById(e.id);this.$parent.openMarkerWindow(i,{title:e.sbsStation,content:e.sbsDesc?e.sbsDesc:"暂无详细地址信息"})},addActiveStyle:function(t){this.activeStation&&(this.activeStation.className=this.activeStation.className.replace(" active","")),this.activeStation=t,t.className+=" active"},getItemById:function(t){for(var e=null,n=this.$refs.stationList.children,i=0;i<n.length;i++){var a=n[i];if("li"===a.tagName.toLowerCase()&&a.getAttribute("stationId")==t){e=a;break}}return e},scrollToActive:function(t){var e=document.querySelector(".happy-scroll-container"),n=e.offsetHeight,i=t.offsetTop,a=e.scrollTop,s=i-a;(s<0||s>n)&&(e.scrollTop+=s-100)},searchStation:function(){var t=this.getStationMsgByName(this.stationName);if(t){var e=t.id,n=this.getItemById(e);this.addActiveStyle(n),this.scrollToActive(n),n.click()}},getStationMsgByName:function(t){return this.stations.find((function(e){if(e.sbsStation.includes(t))return!0}))},delStation:function(t,e){var n=this,i=e.id;this.$axios.post("/busposition/m/station/del",{id:i}).then((function(t){n.$message({type:"success",message:"删除成功"}),n.delStationById(i),n.$emit("delMarker",i)})),t.stopPropagation()},delStationById:function(t){this.stations.find((function(e,n,i){if(e.id===t)return i.splice(n,1),!0}))}}}),d=l,u=(n("f176"),n("6691")),f=Object(u["a"])(d,o,c,!1,null,null,null),p=f.exports,h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"station_operate"}},[n("div",{staticClass:"head"},[n("i",{staticClass:"el-icon-back",on:{click:t.back}}),t._v("\n        "+t._s("add"===t.type?"添加站点":"修改站点")+"\n    ")]),n("el-form",{ref:"stationForm",staticClass:"station-form",attrs:{model:t.stationForm,rules:t.rules,size:"mini"}},[n("el-form-item",{attrs:{label:"站点名",prop:"sbsStation"}},[n("el-input",{model:{value:t.stationForm.sbsStation,callback:function(e){t.$set(t.stationForm,"sbsStation","string"===typeof e?e.trim():e)},expression:"stationForm.sbsStation"}})],1),n("el-form-item",{attrs:{label:"经度"}},[n("el-input",{attrs:{disabled:""},model:{value:t.stationForm.sbsLongitude,callback:function(e){t.$set(t.stationForm,"sbsLongitude","string"===typeof e?e.trim():e)},expression:"stationForm.sbsLongitude"}})],1),n("el-form-item",{attrs:{label:"纬度"}},[n("el-input",{attrs:{disabled:""},model:{value:t.stationForm.sbsLatitude,callback:function(e){t.$set(t.stationForm,"sbsLatitude","string"===typeof e?e.trim():e)},expression:"stationForm.sbsLatitude"}})],1),n("el-form-item",{staticClass:"desc",attrs:{label:"地址",prop:"sbsDesc"}},[n("el-input",{attrs:{type:"textarea"},model:{value:t.stationForm.sbsDesc,callback:function(e){t.$set(t.stationForm,"sbsDesc","string"===typeof e?e.trim():e)},expression:"stationForm.sbsDesc"}})],1),n("el-form-item",{staticClass:"btn"},[n("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(e){return t.submitForm("stationForm")}}},[t._v("\n                "+t._s("add"===t.type?"添加":"修改")+"\n            ")])],1)],1)],1)},v=[],g=(n("d4d5"),{props:{type:String,stationForm:{sbsStation:String,sbsLongitude:Number,sbsLatitude:Number,sbsDesc:String}},data:function(){return{copyForm:JSON.parse(JSON.stringify(this.stationForm)),rules:{sbsStation:[{required:!0,message:"请输入站点名",trigger:"blur"}]}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(t)switch(e.type){case"add":e.addStation();break;case"edit":e.editStation();break}}))},addStation:function(){var t=this;this.$axios.post("/busposition/m/station/add",this.stationForm).then((function(e){t.$message({type:"success",message:"添加成功"}),t.$emit("addData",e.data.data),t.$parent.changeComponent("StationList")}))},editStation:function(){var t=this;this.$axios.post("/busposition/m/station/update",this.stationForm).then((function(e){t.$message({type:"success",message:"修改成功"}),t.$emit("editData",t.stationForm),t.$parent.changeComponent("StationList")}))},back:function(){"add"===this.type?this.$parent.removeActiveMarker():this.$emit("cancelEdit",this.copyForm),this.$parent.changeComponent("StationList")}}}),m=g,b=(n("f84d"),Object(u["a"])(m,h,v,!1,null,null,null)),k=b.exports,y={data:function(){return{center:{lng:0,lat:0},zoom:3,BMap:null,map:null,stations:[],landMarkers:[],activeMarker:null,curComponent:"StationList",type:"add",stationData:{}}},components:{BaiduMap:r["a"],StationList:p,StationOperate:k},methods:{initMap:function(t){var e=this,n=t.BMap,i=t.map;this.center.lng=116.404,this.center.lat=39.915,this.zoom=15,this.BMap=n,this.map=i,this.map.addControl(new n.NavigationControl),this.map.addControl(new n.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT})),this.map.addEventListener("click",this.mapClickCallback),this.getStationList().then((function(){e.stations.forEach((function(t){var n=e.addLandMarker(new e.BMap.Point(t.sbsLongitude,t.sbsLatitude)),i=e.initMarker(t.id,n);e.landMarkers.push(i)}))})).then((function(){var t=e.stations[0];e.map.panTo(new e.BMap.Point(t.sbsLongitude,t.sbsLatitude))}))},mapClickCallback:function(t){var e=this;this.activeMarker?(this.activeMarker.setPosition(t.point),this.stationData.sbsLongitude=this.activeMarker.getPosition().lng,this.stationData.sbsLatitude=this.activeMarker.getPosition().lat):(this.activeMarker=this.addLandMarker(t.point),this.activeMarker.enableDragging(),this.activeMarker.addEventListener("dragend",(function(){e.stationData.sbsLongitude=e.activeMarker.getPosition().lng,e.stationData.sbsLatitude=e.activeMarker.getPosition().lat})),this.stationData={sbsStation:"",sbsLongitude:t.point.lng,sbsLatitude:t.point.lat,sbsDesc:""}),this.addressResolution(t.point),"StationOperate"==this.curComponent&&"add"==this.type||(this.changeComponent("StationOperate"),this.type="add")},addressResolution:function(t){var e=new this.BMap.Geocoder;e.getLocation(t,(function(t){console.log(t.address)}))},initMarker:function(t,e){var n=this;return e.id=t,e.addEventListener("click",(function(t){var e=t.target.id,i=n.$refs.childList.getItemById(e),a=n.getStationMsgById(e);n.$refs.childList.addActiveStyle(i),n.$refs.childList.scrollToActive(i);var s=n.getStationMsgById(e),r={title:s.sbsStation,content:a.sbsDesc?a.sbsDesc:"暂无详细地址信息"};n.openMarkerWindow(t.target,r),t.domEvent.stopPropagation()})),e.addEventListener("dragend",(function(t){n.stationData.sbsLongitude=t.point.lng,n.stationData.sbsLatitude=t.point.lat})),Object(s["a"])({},t,e)},getMarkerById:function(t){var e=null;return this.landMarkers.find((function(n){var i=Object.keys(n)[0];if(i==t)return e=n[i],!0})),e},getStationMsgById:function(t){return this.stations.find((function(e){if(e.id==t)return!0}))},editStationById:function(t){this.stations.find((function(e,n,i){if(e.id==t.id)return i.splice(n,1,t),!0}))},addLandMarker:function(t){var e=new BMap.Marker(t);return this.map.addOverlay(e),e},delLandMarker:function(t){var e=this.getMarkerById(t);this.map.removeOverlay(e),this.landMarkers.find((function(e,n,i){var a=Object.keys(e)[0];a==t&&i.splice(n,1)}))},getStationList:function(){var t=this;return this.$axios("/busposition/m/station/list").then((function(e){return t.stations=e.data.data,Promise.resolve()}))},openMarkerWindow:function(t,e){var n=t.getPosition();this.map.panTo(n),t.openInfoWindow(this.createInfoWindow(e.title,e.content))},createInfoWindow:function(t,e){var n=new this.BMap.InfoWindow,i=document.createElement("h4");i.innerText=t;var a=document.createElement("p");return a.style.fontSize="14px",a.innerText=e,n.setTitle(i),n.setContent(a),n},addData:function(t){this.stations.push(t),this.removeActiveMarker();var e=this.addLandMarker(new this.BMap.Point(t.sbsLongitude,t.sbsLatitude)),n=this.initMarker(t.id,e);this.landMarkers.push(n)},editData:function(t){this.editStationById(t);var e=this.getMarkerById(t.id);e.disableDragging(),this.map.addEventListener("click",this.mapClickCallback)},editHandler:function(t){this.stationData=JSON.parse(JSON.stringify(t)),this.type="edit",this.changeComponent("StationOperate");var e=this.getMarkerById(t.id);e.enableDragging(),this.map.removeEventListener("click",this.mapClickCallback)},lngChange:function(t,e){console.log("lng",e);var n=this.getMarkerById(t),i=new this.BMap.Point(parseFloat(e),n.getPosition().lat);n.setPosition(i),this.map.panTo(i)},latChange:function(t,e){console.log("lat",e);var n=this.getMarkerById(t),i=new this.BMap.Point(n.getPosition().lng,parseFloat(e));console.log("point",i),n.setPosition(i),this.map.panTo(i)},changeComponent:function(t){this.curComponent=t},removeActiveMarker:function(){this.activeMarker&&(this.map.removeOverlay(this.activeMarker),this.activeMarker=null)},cacelEdit:function(t){var e=this.getMarkerById(t.id);e.setPosition(new this.BMap.Point(t.sbsLongitude,t.sbsLatitude)),this.map.addEventListener("click",this.mapClickCallback),e.disableDragging()}}},S=y,M=(n("0e08"),Object(u["a"])(S,i,a,!1,null,null,null));e["default"]=M.exports},"629c":function(t,e,n){"use strict";n("3a59");var i=n("e5ef"),a=n("743d"),s=n("b6f1"),r=n("f01a"),o=n("8b37"),c=n("1f98"),l=o("species"),d=!s((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),u=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();t.exports=function(t,e,n){var f=o(t),p=!s((function(){var e={};return e[f]=function(){return 7},7!=""[t](e)})),h=p?!s((function(){var e=!1,n=/a/;return n.exec=function(){return e=!0,null},"split"===t&&(n.constructor={},n.constructor[l]=function(){return n}),n[f](""),!e})):void 0;if(!p||!h||"replace"===t&&!d||"split"===t&&!u){var v=/./[f],g=n(r,f,""[t],(function(t,e,n,i,a){return e.exec===c?p&&!a?{done:!0,value:v.call(e,n,i)}:{done:!0,value:t.call(n,e,i)}:{done:!1}})),m=g[0],b=g[1];i(String.prototype,t,m),a(RegExp.prototype,f,2==e?function(t,e){return b.call(t,this,e)}:function(t){return b.call(t,this)})}}},"91a1":function(t,e,n){var i=n("22e9"),a=n("f01a");t.exports=function(t,e,n){if(i(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(a(t))}},"984f":function(t,e,n){var i=n("8b37")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[i]=!1,!"/./"[t](e)}catch(a){}}return!0}},b0f4:function(t,e,n){"use strict";var i=n("2f03")(!0);t.exports=function(t,e,n){return e+(n?i(t,e).length:1)}},c9d6:function(t,e,n){},df99:function(t,e,n){"use strict";var i=n("b2f5"),a=n("91a1"),s="includes";i(i.P+i.F*n("984f")(s),"String",{includes:function(t){return!!~a(this,t,s).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},f176:function(t,e,n){"use strict";var i=n("fdd7"),a=n.n(i);a.a},f301:function(t,e,n){"use strict";var i=n("b2f5"),a=n("9f58")(!0);i(i.P,"Array",{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n("644a")("includes")},f425:function(t,e,n){"use strict";var i=n("a013");t.exports=function(){var t=i(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},f84d:function(t,e,n){"use strict";var i=n("2ffd"),a=n.n(i);a.a},f9f2:function(t,e,n){var i=n("b2f5"),a=n("a4cc"),s=n("b6f1");t.exports=function(t,e){var n=(a.Object||{})[t]||Object[t],r={};r[t]=e(n),i(i.S+i.F*s((function(){n(1)})),"Object",r)}},fb37:function(t,e,n){var i=n("db4b"),a=n("cfc7");n("f9f2")("keys",(function(){return function(t){return a(i(t))}}))},fdd7:function(t,e,n){}}]);
//# sourceMappingURL=chunk-3d7b6326.738f0f71.js.map